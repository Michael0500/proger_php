–í–æ—Ç –ø—Ä–∏–º–µ—Ä **—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Å–æ–ª—å–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞ –¥–ª—è Yii2**, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–∑–±–∏–≤–∞–µ—Ç **–ª—é–±–æ–π –±–æ–ª—å—à–æ–π XML-—Ñ–∞–π–ª –ø–æ —É–∑–ª–∞–º –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `PARAM`, `ROOM`, `STEAD` –∏ –¥—Ä.) –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–∞–∂–¥—ã–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª.

---

## ‚úÖ –ö–æ–Ω—Å–æ–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –≤ Yii2

### 1. üìÅ –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `SplitXmlController.php` –≤ `console/controllers`

```php
<?php

namespace console\controllers;

use Yii;
use yii\console\Controller;

class SplitXmlController extends Controller
{
    /**
     * –†–∞–∑–±–∏–≤–∞–µ—Ç –±–æ–ª—å—à–æ–π XML-—Ñ–∞–π–ª –ø–æ —ç–ª–µ–º–µ–Ω—Ç–∞–º (–Ω–∞–ø—Ä–∏–º–µ—Ä: PARAM, ROOM, STEAD)
     *
     * @param string $inputPath –ü—É—Ç—å –∫ XML-—Ñ–∞–π–ª—É
     * @param string|null $elementName –ò–º—è —ç–ª–µ–º–µ–Ω—Ç–∞ (–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ)
     * @param int $batchSize –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞ –æ–¥–∏–Ω –≤—ã—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª
     */
    public function actionIndex(string $inputPath, string $elementName = null, int $batchSize = 1000)
    {
        if (!file_exists($inputPath)) {
            echo "‚ùå –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: $inputPath\n";
            return 1;
        }

        $outputDir = Yii::getAlias('@runtime/xml_split');
        if (!is_dir($outputDir)) {
            mkdir($outputDir, 0777, true);
        }

        $reader = new \XMLReader();
        $reader->open($inputPath);

        $currentItems = [];
        $itemCount = 0;
        $fileIndex = 1;

        while ($reader->read()) {
            // –ù–∞—Ö–æ–¥–∏–º —É–∑–ª—ã –≥–ª—É–±–∏–Ω—ã 2 (–∏–ª–∏ –¥—Ä—É–≥–æ–π, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
            if ($reader->nodeType === \XMLReader::ELEMENT && $reader->depth === 2) {
                if (!$elementName) {
                    $elementName = $reader->name;
                    echo "üß© –ò—Å–ø–æ–ª—å–∑—É–µ–º —ç–ª–µ–º–µ–Ω—Ç: $elementName\n";
                }

                if ($reader->name === $elementName) {
                    $node = $reader->expand();
                    $dom = new \DOMDocument('1.0', 'UTF-8');
                    $node = $dom->importNode($node, true);
                    $dom->appendChild($node);
                    $currentItems[] = $dom->saveXML();
                    $itemCount++;

                    if ($itemCount >= $batchSize) {
                        $this->writeChunk($currentItems, $outputDir, $fileIndex++, $elementName);
                        $currentItems = [];
                        $itemCount = 0;
                    }
                }
            }
        }

        // –û—Å—Ç–∞—Ç–∫–∏
        if (!empty($currentItems)) {
            $this->writeChunk($currentItems, $outputDir, $fileIndex++, $elementName);
        }

        $reader->close();
        echo "‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ: —Å–æ–∑–¥–∞–Ω–æ $fileIndex —Ñ–∞–π–ª–æ–≤ –≤ '$outputDir'\n";
        return 0;
    }

    /**
     * –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç XML-—Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª
     */
    private function writeChunk(array $items, string $outputDir, int $index, string $itemTag)
    {
        $rootTag = $itemTag . 'S';
        $fileName = $outputDir . '/' . strtolower($itemTag) . '_part_' . str_pad($index, 3, '0', STR_PAD_LEFT) . '.xml';

        $xml = "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<$rootTag>\n";
        $xml .= implode("\n", $items);
        $xml .= "\n</$rootTag>";

        file_put_contents($fileName, $xml);
        echo "üìÑ –ó–∞–ø–∏—Å–∞–Ω —Ñ–∞–π–ª: $fileName\n";
    }
}
```

---

### 2. üõ† –î–æ–±–∞–≤—å—Ç–µ –º–∞—Ä—à—Ä—É—Ç –≤ `console/config/main.php`, –µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:

–û–±—ã—á–Ω–æ –Ω–µ –Ω—É–∂–Ω–æ, –µ—Å–ª–∏ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞.

---

### 3. üöÄ –ó–∞–ø—É—Å–∫ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏:

```bash
php yii split-xml /–ø—É—Ç—å/–∫/—Ñ–∞–π–ª—É.xml PARAM 1000
```

* `PARAM` ‚Äî –∏–º—è —É–∑–ª–∞ (–º–æ–∂–Ω–æ –æ–ø—É—Å—Ç–∏—Ç—å, —Ç–æ–≥–¥–∞ –≤–æ–∑—å–º—ë—Ç—Å—è –ø–µ—Ä–≤—ã–π –Ω–∞–π–¥–µ–Ω–Ω—ã–π –Ω–∞ –≥–ª—É–±–∏–Ω–µ 2);
* `1000` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–∑–ª–æ–≤ –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ.

---

### üîÅ –ü—Ä–∏–º–µ—Ä—ã:

```bash
php yii split-xml /data/ROOM.xml
php yii split-xml /data/PARAMS.xml PARAM 500
php yii split-xml /data/STEADS.xml STEAD 2000
```

---

### üìÇ –†–µ–∑—É–ª—å—Ç–∞—Ç:

–§–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `runtime/xml_split/`, –Ω–∞–ø—Ä–∏–º–µ—Ä:

```
params_part_001.xml
params_part_002.xml
...
```

---

### üõ° –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤

* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `XMLReader` + `DOMDocument` ‚Äî —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –ø–∞–º—è—Ç—å—é.
* –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è XML —Ä–∞–∑–º–µ—Ä–æ–º –≤ **–≥–∏–≥–∞–±–∞–π—Ç—ã**.

---

–ï—Å–ª–∏ –≤–∞–º –Ω—É–∂–Ω–æ:

* –†–∞–∑–±–∏–≤–∞—Ç—å –ø–æ **–≤–ª–æ–∂–µ–Ω–Ω–æ–º—É —ç–ª–µ–º–µ–Ω—Ç—É** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `DATA > ITEM`);
* –ü–∞—Ä—Å–∏—Ç—å XML —Å –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞–º–∏ –∏–º—ë–Ω (`xmlns`);
* –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Ñ–∞–π–ª—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ GZ, ZIP –∏ —Ç.–¥.

‚Äî –ø—Ä–æ—Å—Ç–æ —Å–∫–∞–∂–∏—Ç–µ, —è –¥–æ—Ä–∞–±–æ—Ç–∞—é.
