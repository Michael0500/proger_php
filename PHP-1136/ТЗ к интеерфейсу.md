Ниже представлено обобщённое **Техническое задание (ТЗ)**, основанное на требованиях и скриншотах к трем основным модулям:

1. **Модуль шаблонов уведомлений (NOTIFMGR)**
2. **Модуль управления каналами**
3. **Модуль отчётности**

Все описанные требования следует учитывать при проектировании и разработке единой системы, состоящей из этих модулей.

---

# 1. Общая информация

## 1.1. Цель системы

Создать веб-приложение (на базе Yii2 или аналогичного фреймворка) для управления рассылкой уведомлений в различных каналах, а также для формирования и выгрузки отчётности по проведённым рассылкам.

## 1.2. Состав системы

1. **Модуль шаблонов уведомлений (Notification Templates, NOTIFMGR)**:
    - Хранение и редактирование шаблонов уведомлений (их текст, параметры, статус, язык, привязка к клиенту/договору и т. п.).
    - Управление статусами шаблонов.
    - Поиск и фильтрация шаблонов.

2. **Модуль управления каналами (Channel Manager)**:
    - Создание, редактирование, приостановка и возобновление каналов отправки (SMS, e-mail, ENTER/MB/MCSP и т. д.).
    - Настройка свойств каналов (ограничения по длине, временное окно доступности и т. п.).
    - Управление статусами каналов (Active, Stopped, Maintenance и др.).

3. **Модуль отчётности (Reporting Module)**:
    - Фильтрация (поиск) по ключевым параметрам (ID шаблона, ID клиента, статус, канал, даты отправки и пр.).
    - Формирование «оперативных» отчётов (просмотр в веб-интерфейсе) и «исторических» отчётов (выгрузка в CSV, XLSX и пр.).
    - Возможность выгрузки результатов в различные форматы.

## 1.3. Термины и определения

- **Шаблон уведомления (Template)**: Набор полей (ID, наименование, текст, статус, каналы, клиентский сегмент и т. п.), используемый для формирования конкретного сообщения.
- **Канал (Channel)**: Способ доставки уведомления (SMS, e-mail, ENTER/MB/MCSP и т. д.).
- **Рассылка (отправка уведомлений)**: Процесс доставки сформированного по шаблону сообщения по выбранному каналу(ам).
- **Оперативный отчёт**: Быстрый вывод данных по рассылкам/уведомлениям с возможностью просмотра на экране.
- **Исторический отчёт**: Расширенный или детализированный отчёт, выгружаемый для дальнейшего использования (архив, аналитика, хранение).

---

# 2. Функциональные требования

## 2.1. Модуль шаблонов уведомлений

### 2.1.1. Отображение списка шаблонов

1. **Список шаблонов** отображается на стартовом экране модуля.
2. По умолчанию должны быть показаны все имеющиеся активные шаблоны (или все шаблоны вне зависимости от статуса, согласно настройке).
3. **Сортировка** должна осуществляться по:
    - Последней дате изменения или создания (на выбор пользователя, либо по умолчанию).
    - При необходимости по другим полям (ID, наименование, статус).
4. **Критерии поиска/фильтра**:
    - ID шаблона.
    - Наименование (частичное совпадение).
    - Статус шаблона (Active, Error, Stopped и т. д.).
    - Дата создания или изменения (диапазон дат или точная дата).
    - (Опционально) Клиентский сегмент, Продукт, ID договора.

### 2.1.2. Управление шаблонами

1. **Создание нового шаблона**:
    - Поля, обязательные для заполнения: Наименование, ID договора, ID клиента (либо иные, в зависимости от бизнес-логики).
    - Указать статус (по умолчанию «Active» или «Pending»).
    - Указать дату создания (может заполняться автоматически).
2. **Редактирование шаблона**:
    - Изменение полей, сохранение изменений.
    - Дата последнего изменения должна автоматически обновляться (при интеграции с реальной системой).
3. **Просмотр (детализация)**:
    - Отображение всех полей (ID, наименование, текст шаблона, статус, даты, привязка к клиенту/договору, примечания).
4. **Дополнительные действия** (при необходимости):
    - «Остановить» шаблон (временная приостановка рассылок по этому шаблону).
    - «Продолжить» (возобновление рассылок).
    - «Настроить» (открыть форму редактирования).

### 2.1.3. Интерфейс формы шаблона

Форма (при создании и редактировании) должна содержать следующие поля (примерный перечень):

- **ID Шаблона** (генерируется системой или задаётся вручную).
- **Наименование шаблона** (короткое название).
- **Текст шаблона** (если требуется).
- **ID договора, ID клиента** (связь с внешними системами FCC, Siebel и т. д.).
- **Канал(ы) уведомлений** (опционально, если шаблон подразумевает конкретный канал).
- **Дата создания/изменения**.
- **Статус** (Active, Pending, Error, Stopped и др.).
- **Комментарии** (при необходимости).

---

## 2.2. Модуль управления каналами

### 2.2.1. Отображение списка каналов

1. **Список каналов** (SMS, E-mail, ENTER/MB/MCSP и прочие).
2. **Параметры для отображения**:
    - ID канала (уникальный номер).
    - Наименование канала (SMS, E-mail и т. д.).
    - Описание (что за канал, особенности).
    - Статус канала (Active, Stopped, Maintenance).
    - Дополнительные настройки (макс. длина сообщения, временное окно доступности).
3. **Поиск и фильтр**:
    - ID канала, наименование, статус и т. п.

### 2.2.2. Управление каналами

1. **Создание канала**:
    - Ввести наименование, описание, задать параметры (макс. длина, время работы).
    - Установить статус по умолчанию («Active» или «Maintenance»).
2. **Редактирование**:
    - Изменение полей, сохранение.
3. **Остановка (Stop)**:
    - Перевод канала в статус «Stopped», при котором рассылка по данному каналу не выполняется.
4. **Возобновление (Resume)**:
    - Перевод из «Stopped» в «Active».
5. **Просмотр**:
    - Отображение всех параметров канала.

---

## 2.3. Модуль отчётности

### 2.3.1. Поиск по параметрам

1. **Параметры фильтра** (для формирования отчёта):
    - ID шаблона.
    - Наименование шаблона.
    - ID Клиента (CUSTOMER_NO).
    - Статус отправки уведомления (Sent, Pending, Error, Stopped, etc.).
    - Канал уведомления (SMS, E-mail, ENTER/MB/MCSP).
    - Номер мобильного телефона.
    - E-mail.
    - Период отправки (плановая дата, фактическая дата, или период дат).
2. **Возможность комбинированного поиска** по нескольким критериям одновременно.

### 2.3.2. Формирование отчётов

1. **Оперативный отчёт**:
    - Кнопка «Сформировать оперативный отчёт»;
    - Результат отображается на экране (список записей) без необходимости выгрузки в файл.
2. **Исторический отчёт**:
    - Кнопка «Сформировать исторический отчёт»;
    - Предполагается выгрузка в файл (CSV, XLSX и т. п.) с сохранением для дальнейшего использования.
3. **Кнопка «Выгрузить»**:
    - Возможность сохранить оперативный отчёт в пользовательском формате (Excel, CSV и т. п.).

### 2.3.3. Отображение на экране

1. **Таблица** с полями, перечисленными в ТЗ (например, IDTemplate, Текст шаблона, ID Клиента, Плановая/Фактическая дата отправки, Мобильный телефон, E-mail, Статус отправки и т. п.).
2. **Пагинация** (либо прокрутка), если записей слишком много.
3. **Сортировка** по основным полям (ID, дата, статус).

---

# 3. Нефункциональные требования

1. **Интерфейс пользователя**:
    - Должен быть реализован на базе веб-приложения (желательно Yii2).
    - Поддержка многостраничной навигации (GridView, кнопки действий, фильтры).
    - Удобная система поиска (фильтрация) с возможность ввести нужные критерии.
2. **Производительность**:
    - Вариативно, зависит от объёмов данных. При большом объёме рекомендуется пагинация, оптимизация запросов.
3. **Безопасность**:
    - Ограничить доступ к операциям (создание, редактирование, удаление) авторизацией (при необходимости).
    - Защитить от CSRF (стандартные механизмы Yii2).
4. **Отказоустойчивость**:
    - При сбоях в работе каналов/шаблонов пользователю должны быть показаны соответствующие статусы и сообщения.

---

# 4. Дополнительные детали

1. **Интеграция с внешними системами** (FCC, Siebel и т. д.):
    - При реальном внедрении поля «ID Клиента», «ID Договора» и прочие должны проверяться или заполняться из внешних источников.
    - Для тестирования и демонстрации может использоваться mock/фейковые сервисы.

2. **Вывод ошибок**:
    - Если при сохранении шаблона/канала или при формировании отчёта возникла ошибка (например, «Неверный e-mail»), в интерфейсе должно выводиться сообщение об ошибке.

3. **Исторические данные**:
    - Модуль отчётности предполагает хранение или чтение архивных данных. В случае mock-реализации – демонстрационные записи; в реальном проекте – база данных или API.

4. **Кнопки и действия** (обобщённо):
    - **Создать** (Create)
    - **Открыть** (View)
    - **Редактировать** (Update)
    - **Остановить** (Stop)
    - **Продолжить** (Resume)
    - **Сформировать оперативный отчёт**
    - **Сформировать исторический отчёт**
    - **Выгрузить** (Export)

---

# 5. Требования к полям (примерные табличные описания)

### 5.1. Модуль шаблонов уведомлений

| Наименование поля     | Описание                                                       |
|-----------------------|----------------------------------------------------------------|
| **ID шаблона**        | Уникальный идентификатор (присваивается автоматически).        |
| **Наименование**      | Краткое название шаблона (отображается в списках).            |
| **Текст шаблона**     | Полное содержимое уведомления (может быть многострочным).      |
| **Дата создания**     | Дата и время, когда шаблон был создан.                        |
| **Дата изменения**    | Дата и время последнего изменения (обновляется автоматически).|
| **Статус**            | Текущее состояние (Active, Error, Stopped, Pending и др.).     |
| **ID клиента**        | Ссылка на внешний идентификатор клиента (CUSTOMER_NO).         |
| **ID договора**       | Ссылка на внешний идентификатор договора (CONTRACT_ID).        |
| **Продукт**           | Привязка к конкретному продукту (при необходимости).           |
| **Клиентский сегмент**| Сегмент клиента (VIP, Standard, др.).                         |
| **Канал**             | Канал, по которому отправляются уведомления (опционально).     |
| **Примечания**        | Текстовое поле для служебной информации.                       |

### 5.2. Модуль управления каналами

| Наименование поля    | Описание                                                         |
|----------------------|------------------------------------------------------------------|
| **ID канала**        | Уникальный номер канала.                                         |
| **Наименование**     | SMS, E-mail, ENTER/MB/MCSP и т. д.                               |
| **Описание**         | Краткая характеристика, для чего канал и как работает.           |
| **Статус**           | Active, Stopped, Maintenance.                                    |
| **Макс. длина**      | Максимальная длина сообщения (актуально для SMS).                |
| **Временное окно**   | Часы работы канала (например, 24/7 или 8:00-22:00).              |

### 5.3. Модуль отчётности

| Наименование поля             | Описание                                                           |
|-------------------------------|--------------------------------------------------------------------|
| **IDTemplate** (template_id)  | Уникальный номер шаблона                                           |
| **Текст шаблона**            | Текст (суть) уведомления                                           |
| **ID Клиента**               | CUSTOMER_NO                                                         |
| **Дата окончания кредита**    | loan_end_date (если актуально для бизнес-логики)                   |
| **Плановая дата отправки**    | Запланированная дата (конкретный день)                             |
| **Фактическая дата отправки** | Реальная дата, когда уведомление было отправлено                   |
| **Мобильный телефон**         | Номер телефона, на который отсылалось уведомление                  |
| **E-mail**                    | Адрес электронной почты для уведомления                            |
| **Статус отправки**           | Текущее состояние отправки (Sent, Error, Pending, Stopped и т. д.) |
| **Канал**                     | Канал, по которому ушло уведомление (SMS, E-mail, ENTER/MB/MCSP).  |

---

# 6. Требования к интерфейсам

1. **Главная страница (Dashboard)**:
    - Меню или кнопки для доступа к трем модулям: «Шаблоны уведомлений», «Управление каналами», «Отчётность».

2. **Модуль шаблонов**:
    - Страница списка (GridView), где все шаблоны (столбцы: ID, Наименование, Дата создания, Статус и т. д.).
    - Фильтрация (ID, Название, Статус, Дата).
    - Кнопка «Создать» (переход к форме создания).
    - Действия «Открыть» (View) и «Редактировать» (Update).
    - При необходимости — «Остановить» и «Продолжить».

3. **Модуль каналов**:
    - Список каналов (ID, Название, Статус, Доп. поля).
    - Кнопка «Создать канал».
    - Действия «Открыть» (View), «Редактировать», «Остановить», «Продолжить».
    - Поиск по ID, названию, статусу.

4. **Модуль отчётности**:
    - Фильтр (ID Шаблона, Наименование, ID Клиента, Статус, Канал, Даты, Телефон, E-mail).
    - Кнопки «Сформировать оперативный отчёт», «Сформировать исторический отчёт», «Выгрузить».
    - Таблица с результатами (IDTemplate, Клиент, Статус, Даты отправки и пр.).
    - Отсутствующие данные (например, фактическая дата не установлена) должны отображаться пустым полем.

---

# 7. Требования к интеграции и данным

1. **Mock-сервисы** (FakeTemplateService, FakeChannelService, FakeReportService) могут быть использованы для демо-версии, разработки и тестирования. В боевой среде эти сервисы должны быть заменены на реальные источники данных (БД, REST API).
2. **Форматы выгрузки** (исторический отчёт, экспорт) могут включать CSV, XLSX, PDF — по согласованию.
3. **Валидация данных**:
    - В обязательных полях не допускаются пустые значения.
    - ID клиента, ID договора, номера телефонов и e-mail при необходимости проходят дополнительную проверку/маску.

---

# 8. Риски и ограничения

1. **Возможные ограничения**:
    - При огромном количестве записей (шаблонов, отчётов) может потребоваться оптимизация и пагинация.
    - При использовании нестандартных каналов может потребоваться дополнительная логика (например, лимит количества сообщений).
2. **Риски**:
    - Некорректный ввод данных (ошибочные телефоны, e-mail).
    - Сбой интеграции с внешними системами (FCC, Siebel).
    - Ошибки в фильтрах при формировании отчётов (пользователь не видит нужные записи).

---

# 9. Проверка выполнения требований

1. **Проверка функций модуля шаблонов**:
    - Создать новый шаблон → убедиться, что он появляется в списке.
    - Редактировать шаблон → поля обновляются, статус меняется.
    - Проверить поиск по ID, названию, статусу.

2. **Проверка функций модуля каналов**:
    - Создать канал (SMS) → появляется в списке, статус «Active».
    - «Остановить» канал → статус меняется на «Stopped».
    - «Продолжить» канал → статус возвращается в «Active».

3. **Проверка модуля отчётности**:
    - Фильтрация по ID шаблона, статусу и каналу → в результатах только соответствующие записи.
    - «Сформировать оперативный отчёт» → отображение без пагинации или в сокращённом виде (по ТЗ).
    - «Сформировать исторический отчёт» → выгрузка файла (CSV или XLSX).
    - «Выгрузить» → сохранение оперативного отчёта в пользовательском формате (по договорённости).

---

# 10. Вывод

Данная спецификация описывает **единый сервис** из трёх модулей:

1. **Модуль шаблонов уведомлений**
2. **Модуль управления каналами**
3. **Модуль отчётности**

и формулирует требования к интерфейсам, полям, функционалу (CRUD-операции и т. д.).

В результате внедрения должна получиться система, позволяющая:

- **Управлять шаблонами** (создавать, редактировать, останавливать, продолжать).
- **Управлять каналами** (создавать, останавливать, возобновлять, редактировать).
- **Формировать и выгружать отчёты** по различным параметрам (оперативные/исторические).

При этом в рамках пилотного (тестового) варианта все данные могут храниться в **mock-сервисах**, а впоследствии — в реальной базе данных или внешних системах.

---

**Конец ТЗ**